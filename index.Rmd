---
runtime: shiny
title: "WDI Dashboard"
author: "by âˆš3kT/m"
---

```{r setup, include=FALSE}
library(flexdashboard)
library(htmltools)
library(shiny)
library(shinydashboard)
library(shinycssloaders)
library(leaflet)
library(WDI)
library(bslib)
library(plotly)
library(ggplot2)
library(data.table)


```

```{r import-data}

source("apps/data/get-data.r")
source("apps/choose-country-list/choose-country-list.R")
source("apps/choose-indicator/choose-indicator.R")
source("apps/choose-date/choose-date.R")
```

Indicators Overview 
===================================== 

Countries Overview 
=====================================  

```{r}
shinyApp(
  ####
  #UI#
  ####
  ui = fluidPage(
    theme = bs_theme(version = 4, bootswatch = "minty"),
    sidebarLayout(
      sidebarPanel(
        ChooseCountryListUI("1"),
        ChooseIndicatorListUI("2"),
        ChooseDateUI("3")
        
        #,submitButton("Update View", icon("refresh"))
      ),
      mainPanel(tabsetPanel(
        type = "tabs",
        tabPanel("Custom"),
                 #withSpinner(tableOutput("table"), color = "#80c4ac")),
        tabPanel("Overview",
                 withSpinner(
                 plotOutput("plot", brush = "plot_brush"),
                 color = "#80c4ac"
                 ),
                 tableOutput("data")),
        tabPanel("XvsY")
      )
    )
  )),
  ########
  #SERVER#
  ########
  server = function(input, output) {
    
    selectData <- reactive({
      WDI(
        country = ChooseCountryListServer("1")(),
        indicator = ChooseIndicatorListServer("2")(),
        start = ChooseDateServer("3")()[1],
        end = ChooseDateServer("3")()[2]
      )
    })
    
    output$plot <- renderPlot({
      
      plotdata<-melt(setDT(selectData()),
                     id.vars = c("country","iso2c","iso3c","year"),
                     variable.name = "indicator")
      splotdata <- plotdata[dim(plotdata)[1]:1,]
      
      plot <- ggplot()+
        geom_point(plotdata, mapping = aes(year, value, colour = country)) +
        ylab("value") +
        theme_classic() +
        scale_color_grey()
      return(plot)
      }, res = 96)
    #,color="#69b3a2"
      output$data <- renderTable({
        
        plotdata<-melt(setDT(selectData()),
                     id.vars = c("country","iso2c","iso3c","year"),
                     variable.name = "indicator")
        
    brushedPoints(plotdata, input$plot_brush)
      })
      
  }
)
```

Architecture {data-navmenu="Making"}
=====================================  


Widgets {data-navmenu="Making"}
=====================================  


Team
=====================================     
