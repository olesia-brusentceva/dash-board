---
runtime: shiny
title: "WDI Dashboard"
author: "by âˆš3kT/m"
---

```{r setup, include=FALSE}
library(flexdashboard)
library(htmltools)
library(shiny)
library(shinydashboard)
library(shinycssloaders)
library(shinyWidgets)
library(leaflet)
library(WDI)
library(bslib)
library(plotly)
library(ggplot2)
library(data.table)
library(leaflet)
library(geojsonio)
library(rstudioapi)
```

```{r import-data}

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

source("apps/data/get-data.r", chdir=T)
source("apps/choose-country-list/choose-country-list.R", chdir=T)
source("apps/choose-country-map/choose-country-map.R", chdir=T)
source("apps/choose-indicator/choose-indicator.R", chdir=T)
source("apps/choose-date/choose-date.R", chdir=T)

```

```{r ploting}
  #function for linear plotting  
    line_plot <- function(splotdata){
        plot <- ggplot() +
          geom_line(splotdata, mapping = aes(year, value, colour = country)) +
          ylab("value") +
          theme_classic() +
          scale_fill_brewer(palette = "RdPu")
        return(plot)}
  #function for area plotting  
    area_plot <- function(splotdata){
        plot <- ggplot() +
          geom_area(splotdata, mapping = aes(year, value, fill = country)) +
          ylab("value") +
          theme_classic() +
          scale_fill_brewer(palette = "YIGn")
        return(plot)}

```

Indicators Overview 
===================================== 

Countries Overview 
=====================================  

```{r, warning=FALSE}
shinyApp(
  ####
  #UI#
  ####
  ui = fluidPage(
    theme = bs_theme(version = 4, bootswatch = "minty"),
    sidebarLayout(
      sidebarPanel(
        actionButton("update","Update View", icon("refresh"), width = "100%"),
        hr(),
        ChooseCountryMapUI("1"),
        ChooseIndicatorListUI("2"),
        ChooseDateUI("3")
        
        #,submitButton("Update View", icon("refresh"))
      ),
      mainPanel(tabsetPanel(
        type = "tabs",
        tabPanel("Custom"),
                 #withSpinner(tableOutput("table"), color = "#80c4ac")),
        tabPanel(
          "Overview",
          div(
            helpText(
        "Select,what type of plot would you like to see. You can also find some data if you select area out of the plot in 'rectangle'"), hr(),
#            radioGroupButtons(
#              inputId = "change_plot",
#              choices = c(
#                `<i class='fa fa-line-chart'></i>` = "line",
#                `<i class='fa fa-area-chart''></i>` = "area"
#              ),
#              justified = TRUE,
#              selected = "line"
#            )
          ),
                    #withSpinner(
           fluidRow(
             column(6, plotOutput(outputId = "plot", width ="300px", heigth="300px")),
             column(6, plotOutput(outputId ="plot1", width = "300px", height="300px")),
                      #plotOutput("plot",
                                           #width = "50%",
                                           #height = "200px"#,
                                           #brush = "plot_brush"
                                           #),
                                #plotOutput("plot1",
                                 #          width = "50%",
                                  #         height = "200px"#,
                                           #brush = "plot_brush"
                                   #        )
#,color = "#80c4ac")
#,          tableOutput("data")
        )), 
        tabPanel("XvsY", div())
      )
    )
  )),
  ########
  #SERVER#
  ########
  server = function(input, output) {

       
    country.list <- ChooseCountryMapServer("1")
    indicator.list <- ChooseIndicatorListServer("2")
    date.list <- ChooseDateServer("3")
      
    
    selectData <- eventReactive(input$update,{
   
      data = melt(setDT(WDI(
        country = country.list(),
        indicator = indicator.list(),
        start = date.list()[1],
        end = date.list()[2]
      )),id.vars = c("country","iso2c","iso3c","year"),
                     variable.name = "indicator")
      
        return(data)
      },ignoreNULL = FALSE)
    
    output$plot <- renderPlot({

      plotdata<-selectData()
      #identify the number of indicators
      n <- length(unique(plotdata$indicator))
      plotdata<-plotdata[plotdata$indicator == unique(plotdata$indicator)[n],]
      splotdata <- plotdata[dim(plotdata)[1]:1,]

      
      #if (input$change_plot %in% "line") {
        line_plot(splotdata)
      #} else {
       # area_plot(splotdata)
      #}
      
    }, res = 96)
    
    output$plot1 <- renderPlot({

      plotdata<-selectData()
      #identify the number of indicators
      n <- length(unique(plotdata$indicator))
      plotdata<-plotdata[plotdata$indicator == unique(plotdata$indicator)[n],]
      splotdata <- plotdata[dim(plotdata)[1]:1,]

      
      #if (input$change_plot %in% "line") {
        line_plot(splotdata)
      #} else {
       # area_plot(splotdata)
      #}
      
    }, res = 96)
      output$data <- renderTable({
        
        plotdata<-selectData()
        
    brushedPoints(plotdata, input$plot_brush)
      })
      
  }
)
```

Architecture {data-navmenu="Making"}
=====================================  


Widgets {data-navmenu="Making"}
=====================================  


Team
=====================================     
